# Power BI Desktop – Data Preparation

In this section, we will explore methods to transform data in the data model. Transforming the data by renaming tables, updating data types, and appending tables together ensures that the data is ready to be used for reporting. In some instances, this means cleaning the data up so that similar sets of data are combined. In other instances, groups of data are renamed so that they are more recognizable by end users and simplifies report writing.

## Power BI Desktop - Renaming tables

The Query Editor window should appear as shown in the diagram.

- If formula bar is disabled, you can turn on the formula bar from the View ribbon. This enables you to see the “M” code generated by each click on the ribbons.
- Select the options available on the ribbon – Home, Transform, Add Column and View to notice the various features available.

1. Under Queries panel, minimize Transform Files from InternationalSales folder.
2. Select each query name in the Other Queries section.
3. Rename them in the Query Settings -> Properties section as shown below:

| Initial Name       | Final Name          |
| ------------------ | ------------------- |
| sales              | Sales               |
| Product_Table      | Product             |
| geo                | Geography           |
| manufacturer       | Manufacturer        |
| InternationalSales | International Sales |

**Note:** It is best practice to give descriptive query names and column names. These names are used in visuals and in Q&A section, which is covered later in the lab.

## Power BI Desktop – Filling empty values

Some of the data provided is not in the right format. Power BI provides extensive transformation capabilities to clean and prepare the data to meet our needs. Let’s start with Product query. Notice that Category column has a lot of null values. Hover over the green/gray bar (known as quality bar) below the column header. This allows you to easily identify errors and empty values in your data previews. Looks like there are values in Category column only when the value changes. We need to fill it down to have values in each row.

4. From the left panel, select Product Query.
5. Select Category column.
6. From the ribbon select Transform -> Fill -> Down.

Notice now all the null values are filled with the appropriate Category values.

## Power BI Desktop – Splitting columns

In Product query, notice Product column. Looks like the product name and product segment are concatenated into one field with a pipe (\|) separator. Let’s split them into two columns. This will be useful when we build visuals, so we can analyze based on both fields.

7. From the left panel, select Product Query.
8. Select Product column.
9. From the ribbon select Home -> Split Column -> By Delimiter. Split Column by Delimiter dialog opens.
10. In the dialog, make sure Custom is selected in the Select or enter delimiter dropdown.
    **Note:** Select or enter delimiter dropdown has some of the standard delimiters like comma, colon, etc.
11. Notice in the text area, there is a hyphen (-). Power BI assumes we want to split by hyphen. Remove hyphen symbol and enter pipe symbol (\|) as shown in the screenshot.
12. Select OK.

**Note:** If the delimiter occurs multiple times, Split at section provides option to split only once (either left most or right most) or the column can be split on each occurrence of the delimiter.

In this scenario delimiter occurs only once, hence Product column is split into 2 columns.

## Power BI Desktop – Renaming columns

Let’s rename the columns.

13. Select Product.1 column. Right click next to the column name.
14. Select Rename from the selection dialog.
15. Rename the field to Product.
16. Similarly rename Product.2 to Segment.

## Power BI Desktop – Using Column From Examples to split columns

In Product query, notice that the Price column has price and currency concatenated into one field. To do any calculations we just need the numeric value. It will be good to split this field into two columns. We can use the split feature like earlier or we can use Column From Examples. Column From Examples is handy in scenarios where the pattern is more complex than a delimiter.

17. From the left panel, select Product Query.
18. From the ribbon, select Add Column -> Column From Examples -> From All Columns.
19. In the first row of Column1 enter the first Price value which is 412.13 and click enter. Notice as you enter, Power BI knows that you want to split Price column. The formula it uses is displayed as well.
20. Double click column header Text After Delimiter to rename it.
21. Rename the column to MSRP.
22. Click OK to apply the changes.

Notice MSRP field is of data type text. It must be a decimal. Let’s change it.

23. Select ABC in MSRP column.
24. From the selection dialog, select Fixed Decimal Number.

Notice all the steps we performed on the Product query are being recorded under APPLIED STEPS in the right panel.

Similarly, let’s create a currency column.

25. With Product query selected, from the ribbon, select Add Column -> Column From Examples -> From All Columns.
26. In the first row of Column1 enter the first Currency value as USD and click enter Notice as you enter, Power BI knows that you want to split Price column. The formula it uses is displayed as well.
27. Double click column header Text Before Delimiter to rename it.
28. Rename the column to Currency.
29. Click OK to apply the changes.

Now that we have split Price into MSRP and Currency columns, we don’t need Price column. Let’s remove it.

30. From the left panel, select Product Query.
31. Right click next to Price column.
32. Select Remove.

## Power BI Desktop – Removing unwanted rows

In Geography query, notice that first two rows are informational. It is not part of the data. Similarly, in Manufacturer query the last couple of rows are not part of the data. Let’s remove them so we have a clean dataset.

33. In the left panel, select Geography query.
34. From the ribbon, select Home -> Remove Rows -> Remove Top Rows.
35. Remove Top Rows dialog opens. Enter 2 in the text box, since we want to remove the top informational data row and the blank 2nd row.
36. Select OK.

Notice the first row in Geography query now is the column header. So let’s make it a header.

37. With Geography query selected in the left panel, from the ribbon select Home -> Use First Row as Headers. With that step Power BI predicts data type of each field again Notice column Zip was changed to data type number. Let’s change it to text as we did earlier. If we don’t we will see errors when we load the data.
38. Select 123 next to Zip Column. From the dialog, select Text.
39. Select Replace Current in the Change Column Type dialog.
40. From the left panel, select Manufacturer query. Notice the bottom 3 rows are not part of the data. Let’s remove them.
41. From the ribbon, select Home -> Remove Rows -> Remove Bottom Rows
42. Remove Bottom Rows dialog opens. Enter 3 in Number of rows text box.
43. Select OK.

## Power BI Desktop – Transposing data

44. From the left panel, select Manufacturer Query. Notice ManufacturerID, Manufacturer and Logo data is laid across in rows. And the header is not useful. We need to transpose the table to meet our needs.
45. From the ribbon select Transform -> Transpose.

Notice this transposes the data into columns. Now we need the first row to be the header.

46. From the ribbon select Home -> Use First Row as Headers.

Notice now Manufacturer table is laid out the way we need it with a header and values along columns. Notice on the right panel under APPLIED STEPS you will see the list of transformations and steps that have been applied. You can navigate through each change made to the data by clicking on the step. Steps can also be deleted by clicking on the X that appears to the left of the step. The properties of each step can be reviewed by clicking on the gear to the right of the step.

## Power BI Desktop – Appending queries

To analyze the Sales of all countries, it is convenient to have a single Sales table. Hence you want to append all the rows from International Sales to Sales.

47. Select Sales in the Queries window in the left panel as shown in the figure.
48. From the ribbon select Home -> Append Queries. Append dialog opens. There is an option to append Two tables or Three or more tables. Leave Two tables selected since we are appending just two tables.
49. Select International Sales from the drop down and click OK.
    You will now see a new column in the Sales table called Country. Since International Sales had the additional column for Country, Power BI Desktop added the column to the Sales table when it loaded the values from International Sales. You see null values in the Country column by default for the Sales table rows because the column did not exist for the table with USA data. We will add the value “USA” as a data shaping operation.
50. From the ribbon select Add Column -> Conditional Column.
51. In the Add Conditional Column dialog, enter name of the column as “CountryName”.
52. Select Country from the Column Name dropdown.
53. Select equals from the Operator dropdown.
54. Enter null in the Values text.
55. Enter USA in the Output text.
56. Select the dropdown under Else and pick Select a column option.
57. Select Country from the column dropdown.
58. Click OK. This reads, if Country equals null then the value is USA else value is that of Country.
59. You will see the CountryName column in the Query editor window.

The original Country column is only required as a temporary column. It is not required in the final table for analysis and can be removed.

60. Right click on the Country column and select Remove as shown in the figure. We can now rename CountryName column to Country.
61. Right click on the CountryName column and rename to Country.
62. Using Home -> Data Type or by selecting the data type next to the column header, change the data type of the Country column to type Text.
63. Using Home -> Data Type or by selecting the data type next to the column header, change the data type of the Revenue column to type Fixed Decimal Number since it is a currency field. When the data is refreshed, it will process through all the “Applied Steps that you have created. The newly named Country column will have names for all countries, including the USA. You can validate this by clicking on the drop down next to Country column to see the unique values.
64. At first, you will only see USA data. Click on Load more to validate you have data from all 7 countries.
65. Click OK to close this filter.

Typically, when exploring data, we load a subset of data. There are multiple ways to do this. From the ribbon, select Home -> Keep Rows -> Keep Top Rows OR Home > Keep Rows -> Keep Bottom Rows OR Home -> Keep Rows -> Keep Range of Rows. You can use any of these options to filter down to a subset of data. Our dataset has data from 2012 to 2018. For our analysis we want to start with the last 3 years of data (2016-2018). We don’t know how many rows. We can filter by year to get the subset.

66. Select the arrow next to Date in Sales Query.
67. Select Date Filters -> In the Previous…
68. Filter Rows dialog opens. Enter 3 in the text box next to is in the previous.
69. Select years from the dropdown.
70. Select OK.

Now that International Sales data is appended to Sales, we don’t need the International Sales table to load to the data model. Let’s prevent International Sales table from loading to the data model.

71. From the Queries panel on the left, select International Sales query.
72. Right click and select Enable Load. This will disable loading International Sales.

**Note:** The appropriate data from the International Sales table will load into the Sales table each time the model is refreshed. By removing the International Sales table, we are preventing duplicate data from loading into the model and increasing its file size. In some instances, storing very large amounts of data affects the data model performance.

73. From the ribbon select View -> Query Dependencies.

This opens Query Dependencies dialog. The dialog shows the source of each of the queries and dependencies. E.g. We see that Sales query has a csv file source and it has a dependency on International Sales query. This is a useful self-document that can be used to share knowledge with your team members.

74. Select Close in the dialog.

Query Dependencies view can be zoomed in and out as needed.
You have successfully completed import and data shaping operations and are ready to load the data into the Power BI Desktop data model which allows you to visualize the data.

75. Click on File -> Close & Apply.

All the data will be loaded in memory within Power BI Desktop. You will see the progress dialog with the number of rows being loaded in each table as shown in the Figure.

**Note:** It may take several minutes to load all the tables.

76. Select File -> Save to save the file after the data loading is complete. Name the file as “MyFirstPowerBIModel”. Save the file in \DIAD\Reports folder
